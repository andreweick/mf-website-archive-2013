
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>D3: Multiple Brushes - Mission Focus</title>
  <meta name="author" content="Andy Eick">

  
  <meta name="description" content="One of the useful features D3 offers is a dynamic brush that allows one to select a portion of a scale. If desired, SVG elements within the “brushed &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://missionfocus.com/blog/d3-multiple-brushes/">
  <link href="/favicon.ico" rel="icon">
  <link href="/fonts/ss-standard/ss-standard.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/fonts/ss-social/ss-social.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Mission Focus" type="application/atom+xml">
  
  <script type="text/javascript">
    var url = window.location.toString();

    if(url.search("mf.dev") > 0){
      console.log("on dev site -- not tracking with analytics");  
    }
    else {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-320642-7']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    }
  </script>



  
  <meta name="google-site-verification" content="IlOvbFJ83tbiohPgpGpGCPOPx-RS_FCtQ5zt-pbsZIY" />
</head>

<body  id="blog"  class="sidebar-footer">
  <div class="container">
    <div id="content">
      
  
  


<a class="return-link ss-navigateup" href="/blog/">Return to Blog</a>
      <article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">D3: Multiple Brushes</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-16T10:50:00-04:00" pubdate data-updated="true">Oct 16<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>One of the useful features <a href="http://d3js.org/">D3</a> offers is a <a href="https://github.com/mbostock/d3/wiki/SVG-Controls">dynamic brush</a> that allows one to select a portion of a scale. If desired, SVG elements within the “brushed” range of the can then be manipulated. For an in-house project, we wanted to select multiple time ranges using brushes. This great <a href="http://bl.ocks.org/mbostock/1667367">example</a> from D3’s creator made implementing one brush simple (if you haven’t previously implemented a singular brush, you’ll probably want to give the example a look before continuing). However, when we tried to add another brush to the display the brushes weren’t usable, and there didn’t seem to be any D3 documentation about how to achieve the  functionality. There also didn’t seem to be any other examples online with more than one brush. Since it was a feature we needed, we experimented. In the end, by making two simple DOM alterations to the brushes, we were able to create multiple brushes on the same scale. </p>

<p>The brush exposes certain events: ‘brushstart’ when it is started, a series of ‘brush’ events while it is being altered, and a ‘brushend’ event when the alterations end (for more on this see the documentation link above). To provide these events, the brush captures mouse events within its active area (the SVG DOM element in which the brush can be drawn, dragged, and resized), processes the mouse events, and outputs them as one of the three events provided by the brush. </p>

<p><img src="/assets/d3-multiple-brushes/figure1.png" width="675" /></p>

<p>This is sufficient for one brush because every click event is captured by the first brush created. Determining whether a user mouse event should create a new brush or alter an existing brush has to be accomplished manually.</p>

<p>Looking at a brush in the DOM, we realized the brush would respond to mouse events if its pointer-events attribute was set to ‘all’. Setting the same attribute to ‘none’ resulted in the brush no longer honoring (and therefore consuming) click events. By adding a simple jQuery click listener to the DOM element that contains the brush, mouse clicks can be examined if the brush isn’t listening to / consuming click events. To make this happen, each time a brush sends a ‘brushend’ event, the brush’s pointer-events attribute is set to none. That means the brush won’t swallow the next click event, and the event will occur in the jQuery click listener for the active region containing the brush. At this point, logic occurs to determine if the user is holding down the meta-key while clicking. If this is the case, a new brush is created and the old brush remains deactivated. If the user is performing a click without the meta-key, the brush’s pointer-events attribute is set back to ‘all’ and it will continue consuming click events and updating its size/location accordingly.</p>

<p>But that wasn’t the last piece of the puzzle. Simply setting the brush’s ‘pointer-events’ attribute didn’t actually have the desired effect of activating and deactivating the brush. It wasn’t until accidentally stumbling across manually assigning the brush an id attribute that the brushes would activate and deactivate accordingly. Since no mention of id is made in the brush documentation, it’s unclear whether this is an intended or unintended feature in the inner workings of the brush.</p>

<p>While this surely isn’t the most elegant solution to implementing multiple brushes, it seems the best until the brush’s functionality is extended.</p>

<p>You can see a working example below:</p>

<p><a href="../../assets/d3-multiple-brushes/index.html">D3 Multiple Brushes Example</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Andy Eick</span></span>

      

  
  
    <span class='categories ss-tag'><a class='category' href='/blog/categories/institute-for-modern-intelligence/'>Institute for Modern Intelligence</a>, <a class='category' href='/blog/categories/missionfocus/'>MissionFocus</a>, <a class='category' href='/blog/categories/work/'>work</a></span>
  


    </p>
    
      <div class="sharing">
  
</div>

    
    <nav class="pagination">
      
        <a class="f-left ss-navigateleft" href="/blog/reinvent-transit-hackathon/" title="Previous Post: Reinvent Transit Hackathon">Reinvent Transit Hackathon</a>
      
      
        <a class="f-right ss-navigateright right" href="/blog/javacv-on-centtos-6/" title="Next Post: JavaCV on CentTOS 6">JavaCV on CentTOS 6</a>
      
    </nav>
  </footer>
</article>

    </div>
  </div>
  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <div class="footer-subtitle">
  Make It Happen, Move It Forward
</div>

<ul class="navigation">
  <li><a href="/about-us">About Us</a></li>
 	<li><a href="/office">Our Office</a></li>
  <li><a href="/jobs">Jobs</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/press">Press</a></li>
  <li><a href="/contact">Contact</a></li>
</ul>


<p class="copyright">
  Copyright &copy; 2008 - 2013.
</p>

    </div>
  </footer>
  


<script src="/javascripts/retina.js"></script>
</body>
</html>
